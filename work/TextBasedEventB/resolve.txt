in machine impl

@Override
	public EObject eResolveProxy(InternalEObject proxy) {
		if (((proxy instanceof Machine && getRefines().contains(proxy)) || (proxy instanceof Context && getSees()
				.contains(proxy))) && proxy.eIsProxy() && eResource() != null) {
			URI proxyURI = proxy.eProxyURI();
			try {

				String fragment = proxyURI.fragment();

				if (fragment.contains("xtextLink_")) {
					EObject resolved = super.eResolveProxy(proxy);
					return resolved;
				}
......





in eventimpl

	protected String getRefinesName(int index) {
		try{
			//get the current BEvent at the given index (using basicGet to avoid resolving)
			Event event = ((BasicEList<Event>)getRefines()).basicGet(index);
			
			// >>>>>>>>>>>>>>>>>>>>
			// andy's bit to look for the xtextLink
			// .. of course will be a proxy
			if(event.eIsProxy()){
				String ref = event.getReference();
				String id = ref.substring(ref.indexOf("xtextLink_"));
				String replacementName = TextOutUtil.crossRefMap.get(id);
				//remove incorrect identifier
				ref = ref.replace("." + id, "::") + replacementName;
				String uri = getURI().toString();
				URI appendFragment = URI
						.createPlatformResourceURI(uri, true).appendFragment(ref);
				((InternalEObject) event).eSetProxyURI(appendFragment);
			}
			
			//>>>>>>>>>>>>>>>>>>>>>>>>


AND



	public EObject eResolveProxy(InternalEObject proxy){
		if (proxy instanceof Event && proxy.eIsProxy() && getRefines().contains(proxy) && eResource()!=null){
			URI proxyURI = proxy.eProxyURI();
			try { 

				Machine refinedMachine = ((MachineImpl)eContainer).getRefines().get(0);

				String fragment = proxyURI.fragment();
				  if (fragment.contains("::")) {
					  fragment = fragment.substring(fragment.lastIndexOf("::",fragment.length())+2, fragment.length());
				  }	
				  if (fragment.contains(".")) {
					  fragment = fragment.substring(fragment.lastIndexOf(".",fragment.length())+1, fragment.length());
				  }
				  
				  String reference = "";
				 String path = proxyURI.toString();
				 String properFragment = path.substring(path.indexOf("#")+1, path.length());
				if(path.contains("textLink_")){  
					reference = ((EventBElementImpl)proxy).getElementTypePrefix()+"::"+refinedMachine.getName()+"."+properFragment;
				}
				else{
					reference = ((EventBElementImpl)proxy).getElementTypePrefix()+"::"+refinedMachine.getName()+"."+fragment;
				}
				proxy.eSetProxyURI(refinedMachine.getURI().appendFragment(reference));
				
			} catch (Exception e){
				EventbcoreEditPlugin.getPlugin().getLog().log(
						new Status(Status.ERROR, "org.eventb.emf.core","Cannot resolve: " + proxy, e));
			}










